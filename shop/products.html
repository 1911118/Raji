<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Rajdelver - Manage Products</title>
  <link rel="stylesheet" href="../shared/styles.css">
</head>
<body>
  <div class="container">
    <h1>Manage Products</h1>
    <div id="product-form">
      <h2>Add New Product</h2>
      <input type="text" id="name" placeholder="Product Name">
      <input type="number" id="price" placeholder="Price" step="0.01">
      <input type="text" id="category" placeholder="Category">
      <input type="number" id="stock" placeholder="Stock">
      <input type="text" id="image" placeholder="Image URL">
      <button onclick="addProduct()">Add Product</button>
    </div>
    <div id="product-list"></div>
    <button onclick="window.location.href='index.html'">Back to Dashboard</button>
  </div>
  <script src="shop.js"></script>
  <script>
    async function loadProducts() {
      try {
        const response = await fetch('/products');
        const products = await response.json();
        const productList = document.getElementById('product-list');
        
        if (products.length === 0) {
          productList.innerHTML = '<p>No products found</p>';
          return;
        }
        
        productList.innerHTML = products.map(p => `
          <div class="product-card">
            <div class="product-info">
              <h3>${p.name}</h3>
              <p>Price: $${p.price}</p>
              <p>Category: ${p.category}</p>
              <p>Stock: ${p.stock}</p>
              ${p.image ? `<img src="${p.image}" alt="${p.name}" style="max-width: 100px;">` : ''}
            </div>
            <div class="product-actions">
              <button onclick="updateProduct('${p._id}')">Update</button>
              <button onclick="deleteProduct('${p._id}')">Delete</button>
            </div>
          </div>
        `).join('');
      } catch (error) {
        alert('Failed to load products: ' + error.message);
      }
    }

    async function addProduct() {
      const product = {
        name: document.getElementById('name').value,
        price: document.getElementById('price').value,
        category: document.getElementById('category').value,
        stock: document.getElementById('stock').value,
        image: document.getElementById('image').value
      };
      
      try {
        const response = await fetch('/products', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${token}`
          },
          body: JSON.stringify(product)
        });
        const data = await response.json();
        alert('Product added successfully');
        loadProducts();
        // Clear form
        document.getElementById('name').value = '';
        document.getElementById('price').value = '';
        document.getElementById('category').value = '';
        document.getElementById('stock').value = '';
        document.getElementById('image').value = '';
      } catch (error) {
        alert('Failed to add product: ' + error.message);
      }
    }

    async function updateProduct(id) {
      const product = {
        name: prompt('New name:'),
        price: prompt('New price:'),
        category: prompt('New category:'),
        stock: prompt('New stock:'),
        image: prompt('New image URL:')
      };
      
      try {
        const response = await fetch(`/products/${id}`, {
          method: 'PUT',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${token}`
          },
          body: JSON.stringify(product)
        });
        const data = await response.json();
        alert('Product updated successfully');
        loadProducts();
      } catch (error) {
        alert('Failed to update product: ' + error.message);
      }
    }

    async function deleteProduct(id) {
      if (!confirm('Are you sure you want to delete this product?')) return;
      
      try {
        await fetch(`/products/${id}`, {
          method: 'DELETE',
          headers: { 'Authorization': `Bearer ${token}` }
        });
        alert('Product deleted successfully');
        loadProducts();
      } catch (error) {
        alert('Failed to delete product: ' + error.message);
      }
    }

    document.addEventListener('DOMContentLoaded', loadProducts);
  </script>
</body>
</html> 